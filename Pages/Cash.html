<!DOCTYPE html>
<head>
   <title>Cash</title>
   <link rel="icon" href="../Assets/main-icon.png">
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
   <script src="../Assets/420eab8243.js" ></script>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
    .centre
    {
    text-align: center;
    }
    .button {
    padding: 15px 25px;
    font-size: 20px;
    text-align: center;
    cursor: pointer;
    outline: none;
    color: #fff;
    background-color: peru;
    border: none;
    border-radius: 15px;
    box-shadow: 0 9px #999;
    }
    .button:hover {background-color: darkgoldenrod}
    .button:active {
    background-color: peru;
    box-shadow: 0 5px #666;
    transform: translateY(4px);
    }
    .dotted{
       border-style: solid;
    }
    .content {
    padding: 0 18px;
    display: none;
    overflow: hidden;
    }
    .center{
    margin: auto;
    width: 30%;
    align-items: center;  
    padding: 10px;
    }   
    .red
    {
     color:red;
    }
    .card {
         box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
         transition: 0.3s;
         /*width: 40%;*/
     }
 
     .card:hover {
         box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
     }
 
     .container {
         padding: 2px 16px;
     }
     .vertical-center {
   margin: 0;
   position: absolute;
   top: 50%;
   -ms-transform: translateY(-50%);
   transform: translateY(-50%);
 }
 
    .rectangle {
    width: 200px;
    height: 100px;
    border: 1px solid black;
    text-align: center;
    display: inline-block;
    line-height: 50px;
    font-weight: bold;
    font-size: 20px;
    }
    .required::after {
    color: red;
    }
    
    *{
    list-style: none;
    text-decoration: none;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Open Sans', sans-serif;
    }
    body{
    background: #f5f6fa;
    }
    .wrapper .sidebar{
    background: rgb(5, 68, 104);
    position: fixed;
    top: 0;
    left: 0;
    width: 225px;
    height: 100%;
    padding: 20px 0;
    transition: all 0.5s ease;
    }
    .wrapper .sidebar .profile{
    margin-bottom: 30px;
    text-align: center;
    }
    .wrapper .sidebar .profile img{
    display: block;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    margin: 0 auto;
    }
    .wrapper .sidebar .profile h3{
    color: #ffffff;
    margin: 10px 0 5px;
    }
    .wrapper .sidebar .profile p{
    color: rgb(206, 240, 253);
    font-size: 14px;
    }
    .wrapper .sidebar ul li a{
    display: block;
    padding: 13px 30px;
    border-bottom: 1px solid #10558d;
    color: rgb(241, 237, 237);
    font-size: 16px;
    position: relative;
    }
    .wrapper .sidebar ul li a .icon{
    color: #dee4ec;
    width: 30px;
    display: inline-block;
    }
    .wrapper .sidebar ul li a:hover,
    .wrapper .sidebar ul li a.active{
    color: #0c7db1;
    background:white;
    border-right: 2px solid rgb(5, 68, 104);
    }
    .wrapper .sidebar ul li a:hover .icon,
    .wrapper .sidebar ul li a.active .icon{
    color: #0c7db1;
    }
    .wrapper .sidebar ul li a:hover:before,
    .wrapper .sidebar ul li a.active:before{
    display: block;
    }
    .collapsible {
    display: none;
    }
    .collapsible.active {
    display: block;
    }
    .collapsible-button {
    background-color: transparent;
    border: none;
    color: #000;
    font-size: 24px;
    cursor: pointer;
    position: absolute;
    top: 10px;
    left: 10px;
    }
     .centeer {
   margin-left: auto;
   margin-right: auto;
 }
 
 </style>
<body>
   <h2 class="centre">Wallet: Cash</h2>
   <button class="collapsible-button" id="coll-button">&#9776;</button>
    <div class="collapsible">
        
    <div class="wrapper">
        <!--Top menu -->
        <div class="sidebar">
            <button class="collapsible-button" id="dis-collapsible-button" style="color:white">&#9776;</button>
            <br>
            <div class="profile">
                <i class="fa-regular fa-user fa-2xl" style="color: #f7f9fd;"></i>
                <br>    
                <h3 id="name_ussser"></h3>
                <p id="user_name"></p>
                <br>
                <button onclick="logoutFunction()">Logout</button>
            </div>
            <ul>
                <li>
                    <a href="/">
                        <span class="icon"><i class="fas fa-home"></i></span>
                        <span class="item">Home</span>
                    </a>
                </li>
                <li>
                    <a href="CreditCard.html">
                        <span class="icon"><i class="fa-regular fa-credit-card"></i></span>
                        <span class="item">Credit Cards</span>
                    </a>
                </li>
                <li>
                    <a href="Bank.html">
                        <span class="icon"><i class="fa-solid fa-building-columns"></i></span>
                        <span class="item">Banks</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="active">
                        <span class="icon"><i class="fa-solid fa-sack-dollar"></i></span>
                        <span class="item">Cash</span>
                    </a>
                </li>
                <li>
                    <a href="Settings.html">
                        <span class="icon"><i class="fa-solid fa-gear"></i></span>
                        <span class="item">Settings</span>
                    </a>
                </li>

            </ul>
        </div>
        </div>

        </div>

    </div>
    <br>
   <p class="centre" id="cur_balance" style="font-size: 20px;"></p>
   <p class="centre" id="noteCountDisplay" style="font-size: 20px;"></p>
   <br>
   <form class="centre">
      <button class="button" id="inBtn" onclick="money_in()">+ Money comes in</button>
      <br><br>
      <button class="button" id="outBtn" onclick="money_out()">- Money goes out</button>
   </form>
   <div id="details_div" class="margin: auto;
      display: block;
      ">
      <br>
      <h2 class="centre">Transactions</h2>
      <table id="transactions_table" class="center" border="1">
         <thead>
            <th style="margin-left: 10px; margin-right:10px;">Date</th>
            <th style="margin-left: 10px; margin-right:10px;">Particulars</th>
            <th style="margin-left: 10px; margin-right:10px;">Type</th>
            <th style="margin-left: 10px; margin-right:10px;">Amount</th>
            <th style="margin-left: 10px; margin-right:10px;">Actions</th>
         </thead>
         <tbody id="ttbody"></tbody>
      </table>
   </div>
</body>
<script src="../Assets/localforage.js"></script>
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="../Assets/functions.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" src="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<script>
    notional_count = {"500":0, "200":0, "100":0, "50":0, "20":0, "10":0, "5":0, "2":0, "1":0}
    tot_amount = 0
        if(window.navigator.onLine==false)
    {
        alert("You are offline, get back online to login or signup to Wallet")
        document.getElementById('inBtn').disabled=true
        document.getElementById('outBtn').disabled=true
    }
    function localStorageGetItem(vallue)
    {
        return JSON.parse(localStorage.getItem("Wallet"))[vallue]
    }
    const collapsibleButton = document.querySelector('.collapsible-button');
const menu = document.querySelector('.collapsible');

collapsibleButton.addEventListener('click', () => {
    menu.classList.toggle('active');
});


const discollapisbleButton = document.getElementById("dis-collapsible-button");
discollapisbleButton.addEventListener('click', () => {
    menu.classList.remove('active')
});
document.getElementById("name_ussser").innerHTML = localStorageGetItem("NameUser")
document.getElementById("user_name").innerHTML = localStorageGetItem("user_id")


    
  </script>
<script>
   function isStringInList(string, list) {
       var lowercaseString = string.toLowerCase();
       return list.map(item => item.toLowerCase()).includes(lowercaseString);
       }
   
   
   function moneyadded_in()
   {
       event.preventDefault()
       if(document.getElementById("date_transaction").value=="" || document.getElementById("particulars_transaction").value=="" || document.getElementById("amount_transaction").value=="")
       {
           alert("Please enter all the details. The narration is optional")
       }
       else
       {
           data = (localStorageGetItem("CASH"))
           new_object = new Object()
           new_object.Date = document.getElementById("date_transaction").value
           new_object.Particulars = document.getElementById("particulars_transaction").value
           if(localStorageGetItem("particulars_ai")==null)
           {
               array_part =[]
               array_part.push(document.getElementById("particulars_transaction").value)
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               oridata["particulars_ai"]=array_part
               setToStorage(JSON.stringify(oridata))
               
           }
           else
           {
               array_part=(localStorageGetItem("particulars_ai"))
               if(isStringInList(document.getElementById("particulars_transaction").value, array_part)==true)
               {}
               else
               {
                   array_part.push(document.getElementById("particulars_transaction").value)
                   oridata = JSON.parse(localStorage.getItem("Wallet"))
                    oridata["particulars_ai"]=array_part
                    setToStorage(JSON.stringify(oridata))
               }
           }
           data["TRXNUM"]+=1
           let newObj = Object.keys(data["NOTE_COUNT"]).reduce((a, k) => {
                a[k] = data["NOTE_COUNT"][k] + notional_count[k];
                return a;
            }, {});
            // console.log(data["NOTE_COUNT"])
            // console.log(notional_count)
            // console.log(newObj)
           new_object.Type = "Cr"
           new_object.TRXNUM = data["TRXNUM"]
           new_object.Amount = parseInt(document.getElementById("amount_transaction").innerHTML)
           new_object.Narration = document.getElementById("narration").value
           data["TRANSACTIONS"].push(new_object)
           data["TRANSACTIONS"].sort((a, b) => new Date(a.Date) - new Date(b.Date));
           cash_balance = parseFloat(data["CASH_BALANCE"])
           data["NOTE_COUNT"]=newObj
           cash_balance+=parseFloat(document.getElementById("amount_transaction").innerHTML)
           data["CASH_BALANCE"]=cash_balance
           oridata = JSON.parse(localStorage.getItem("Wallet"))
           oridata["CASH"]=data
           setToStorage(JSON.stringify(oridata))
           
           alert("Added!")
           window.location.reload();
       }
   }
   function money_in()
   {
       event.preventDefault()
       document.getElementById("details_div").innerHTML=""
       document.getElementById("details_div").innerHTML+='\
       <br>\
       <h2 class="centre">+ Money comes in</h2>\
       <form><label>Enter the date of the transaction</form><input id="date_transaction" class="margin: auto; display: block;" type="date" placeholder="Enter the date of the transaction"></form>\
       <br><input id="particulars_transaction" class="margin: auto; display: block;" type="text" placeholder="Who paid you money?">\
       <br><ul id="list"></ul>\
       <form id="quick_options">\
        <p>Denominations Available:\
        <br><br>\
       <button class="button" onclick="updateBalance_(500)">₹500</button>\
       <button class="button" onclick="updateBalance_(200)">₹200</button>\
        <button class="button" onclick="updateBalance_(100)">₹100</button>\
        <br><br>\
        <button class="button" onclick="updateBalance_(50)">₹50</button>\
        <button class="button" onclick="updateBalance_(20)">₹20</button>\
        <button class="button" onclick="updateBalance_(10)">₹10</button>\
        <br><br>\
        <button class="button" onclick="updateBalance_(5)">₹5</button>\
        <button class="button" onclick="updateBalance_(2)">₹2</button>\
        <button class="button" onclick="updateBalance_(1)">₹1</button>\
        <br><br>\
        <button class="button" onclick="updateBalance_(0)">Clear</button>\
        <br><br>\
        <br><p id="amount_transaction"></p>\
       <br><input id="narration" class="margin: auto; display: block;" type="text" placeholder="Enter narration"></p>\
       <br><button onclick="moneyadded_in()">Add transaction</button>'
       if (localStorageGetItem("particulars_ai")==null)
       {
   
       }
       else
       {
           var listItems = (localStorageGetItem("particulars_ai"))
   var listElement = document.getElementById('list');
   var searchInput = document.getElementById('particulars_transaction');
   
   // Function to filter the list based on search input
   function filterList() {
     var searchValue = searchInput.value.toLowerCase();
     var filteredList = listItems.filter(function(item) {
       return item.toLowerCase().includes(searchValue);
     });
     renderList(filteredList);
   }
   
   // Function to render the list
   function addText(text)
   {
       document.getElementById("particulars_transaction").value = text
   }
   // Function to render the list
   function renderList(items) {
     listElement.innerHTML = '';
     items.forEach(function(item) {
       var li = document.createElement('li');
       
       li.textContent = item;
       li.addEventListener("click", function(){addText(li.textContent)})
       listElement.appendChild(li);
     });
   }
   
   
   // Event listener for search input
   searchInput.addEventListener('input', filterList);
   
   // Initial list rendering
   renderList(listItems);
       }
       
   }
   function updateBalance(amount) {
        event.preventDefault()
        data = localStorageGetItem("CASH")["NOTE_COUNT"]
        if(amount==0)
        {
            document.getElementById("amount_transaction").innerHTML=""
            notional_count = {"500":0, "200":0, "100":0, "50":0, "20":0, "10":0, "5":0, "2":0, "1":0}
            tot_amount = 0
        }
        else
        {
            if (notional_count[amount]+1>data[amount]){
                alert("You do not have any more ₹"+ amount+" notes")
            }
            else{
                notional_count[amount]+=1
                tot_amount+=amount
                document.getElementById("amount_transaction").innerHTML=tot_amount
            }
        }
        
   }
   function updateBalance_(amount) {
        event.preventDefault()
        data = localStorageGetItem("CASH")["NOTE_COUNT"]
        if(amount==0)
        {
            document.getElementById("amount_transaction").innerHTML=""
            notional_count = {"500":0, "200":0, "100":0, "50":0, "20":0, "10":0, "5":0, "2":0, "1":0}
            tot_amount = 0
        }
        else
        {
            notional_count[amount]+=1
            tot_amount+=amount
            document.getElementById("amount_transaction").innerHTML=tot_amount
        }
        
   }
   function moneyadded_out()
   {
       event.preventDefault()
       if(document.getElementById("date_transaction").value=="" || document.getElementById("particulars_transaction").value=="" || document.getElementById("amount_transaction").innerHTML=="")
       {
           alert("Please enter all the details. The narration is optional")
       }
       else
       {
           data = (localStorageGetItem("CASH"))
           new_object = new Object()
           new_object.Date = document.getElementById("date_transaction").value
           new_object.Particulars = document.getElementById("particulars_transaction").value
           if(localStorageGetItem("particulars_ai")==null)
           {
               array_part =[]
               array_part.push(document.getElementById("particulars_transaction").value)
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               oridata["particulars_ai"]=array_part
               setToStorage(JSON.stringify(oridata))   
           }
           else
           {
               array_part=(localStorageGetItem("particulars_ai"))
               if(isStringInList(document.getElementById("particulars_transaction").value, array_part)==true)
               {}
               else
               {
                   array_part.push(document.getElementById("particulars_transaction").value)
                   oridata = JSON.parse(localStorage.getItem("Wallet"))
                    oridata["particulars_ai"]=array_part
                    setToStorage(JSON.stringify(oridata))
               }
           }
           data["TRXNUM"]+=1
           let newObj = Object.keys(data["NOTE_COUNT"]).reduce((a, k) => {
                a[k] = data["NOTE_COUNT"][k] - notional_count[k];
                return a;
            }, {});
           new_object.Type = "Dr"
           new_object.TRXNUM = data["TRXNUM"]
           new_object.Amount = parseInt(document.getElementById("amount_transaction").innerHTML)
           new_object.Narration = document.getElementById("narration").value
           data["TRANSACTIONS"].push(new_object)
           data["TRANSACTIONS"].sort((a, b) => new Date(a.Date) - new Date(b.Date));
           cash_balance = parseFloat(data["CASH_BALANCE"])
           cash_balance-=parseFloat(document.getElementById("amount_transaction").innerHTML)
           data["CASH_BALANCE"]=cash_balance
           data["NOTE_COUNT"]=newObj
           oridata = JSON.parse(localStorage.getItem("Wallet"))
           oridata["CASH"]=data
           setToStorage(JSON.stringify(oridata))
           alert("Added!")
           window.location.reload();
       }
   }
   function money_out()
   {
       event.preventDefault()
       document.getElementById("details_div").innerHTML=""
       document.getElementById("details_div").innerHTML+='\
       <br>\
       <h2 class="centre">- Money goes out</h2>\
       <form><label>Enter the date of the transaction</form><input id="date_transaction" class="margin: auto; display: block;" type="date" placeholder="Enter the date of the transaction"></form>\
       <br><input id="particulars_transaction" class="margin: auto; display: block;" type="text" placeholder="Whom did you pay money?">\
       <br><ul id="list"></ul>\
       <br>\
        <form id="quick_options">\
        <p>Denominations Available:\
        <br><br>\
       <button class="button" onclick="updateBalance(500)">₹500</button>\
       <button class="button" onclick="updateBalance(200)">₹200</button>\
        <button class="button" onclick="updateBalance(100)">₹100</button>\
        <br><br>\
        <button class="button" onclick="updateBalance(50)">₹50</button>\
        <button class="button" onclick="updateBalance(20)">₹20</button>\
        <button class="button" onclick="updateBalance(10)">₹10</button>\
        <br><br>\
        <button class="button" onclick="updateBalance(5)">₹5</button>\
        <button class="button" onclick="updateBalance(2)">₹2</button>\
        <button class="button" onclick="updateBalance(1)">₹1</button>\
        <br><br>\
        <button class="button" onclick="updateBalance(0)">Clear</button>\
        <br><br>\
        <br><p id="amount_transaction"></p>\
       <br><input id="narration" class="margin: auto; display: block;" type="text" placeholder="Enter narration"></p>\
       <br><button onclick="moneyadded_out()">Add transaction</button>'
       if (localStorageGetItem("particulars_ai")==null)
       {
   
       }
       else
       {
           var listItems = (localStorageGetItem("particulars_ai"))
   var listElement = document.getElementById('list');
   var searchInput = document.getElementById('particulars_transaction');
   
   // Function to filter the list based on search input
   function filterList() {
     var searchValue = searchInput.value.toLowerCase();
     var filteredList = listItems.filter(function(item) {
       return item.toLowerCase().includes(searchValue);
     });
     renderList(filteredList);
   }
   function addText(text)
   {
       document.getElementById("particulars_transaction").value = text
   }
   // Function to render the list
   function renderList(items) {
     listElement.innerHTML = '';
     items.forEach(function(item) {
       var li = document.createElement('li');
       
       li.textContent = item;
       li.addEventListener("click", function(){addText(li.textContent)})
       listElement.appendChild(li);
     });
   }
   
   // Event listener for search input
   searchInput.addEventListener('input', filterList);
   
   // Initial list rendering
   renderList(listItems);
       }
   }
   if(localStorageGetItem("CASH")==null)
   {
       window.location.href="Settings.html?addType=C"
   }
   else
   {
       data = (localStorageGetItem("CASH"))
       document.getElementById("cur_balance").innerHTML = `Balance : ₹ ${data["CASH_BALANCE"]}`
       noteCounts = data["NOTE_COUNT"]
       document.getElementById('noteCountDisplay').textContent = `Notes in Hand - ₹500: ${noteCounts['500']}, ₹200: ${[noteCounts['200']]}, ₹100: ${noteCounts['100']}, ₹50: ${noteCounts['50']}, ₹20: ${[noteCounts['20']]}, ₹10: ${noteCounts['10']}, ₹5: ${noteCounts['5']}, ₹1: ${noteCounts['1']}`;
       if(data["TRANSACTIONS"].length==0)
       {
           document.getElementById("transactions_table").style.visibility="hidden"
           var no_trx = document.createElement("h2")
           no_trx.innerHTML="No transactions found"
           no_trx.style.cssText = 'text-align:center;';
           document.getElementById("details_div").appendChild(no_trx)
       }
       else
       {
           data = (localStorageGetItem("CASH"))
           trx = data["TRANSACTIONS"]
           trx.forEach(add)
           if(document.getElementById("transactions_table").rows.length==1)
           {
            document.getElementById("transactions_table").style.visibility="hidden"
           var no_trx = document.createElement("h2")
           no_trx.innerHTML="No transactions found"
           no_trx.style.cssText = 'text-align:center;';
           document.getElementById("details_div").appendChild(no_trx)
           }
       }
   }
   function add(item)
   {
        if(item["Particulars"]=="Modifying Entry"&&item["Narration"]=="Being modification entry passed")
       {
        
       }
       else
       {
            var newRow = document.createElement("tr")
        var newDate = document.createElement("td")
        date = `${item["Date"].split("-")[2]}-${item["Date"].split("-")[1]}-${item["Date"].split("-")[0]}`
        newDate.innerHTML=date
        var newParticulars = document.createElement("td")
        newParticulars.innerHTML=item["Particulars"]
        var newType = document.createElement("td")
        newType.innerHTML=item["Type"]
        var newAmount = document.createElement("td")
        newAmount.innerHTML=item["Amount"]
        var newB = document.createElement("td")
        var newButton = document.createElement("button")
        newButton.innerHTML="🔍\nActions:\nView\n and Delete"
        newButton.addEventListener("click", function(){window.location.href=`ViewTransaction.html?type=C&trxnum=${item["TRXNUM"]}`})
        if(item["Particulars"].includes("Payment of") && item["Particulars"].includes("Credit Card"))
       {
        newButton.disabled=true
       }
        newRow.appendChild(newDate)
        newRow.appendChild(newParticulars)
        newRow.appendChild(newType)
        newRow.appendChild(newAmount)
        newB.appendChild(newButton)
        newRow.appendChild(newB)
       
       
        document.getElementById("transactions_table").appendChild(newRow)
    }
       
   }
   
   
   $(document).ready(function() {
    $('#transactions_table').DataTable();
    $(".dataTables_empty").empty();
});
data = JSON.parse(localStorage.getItem("Wallet"))
    userName = data["user_id"]
    fetch(`https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData?user_id=eq.${userName}`, {
  method: "GET", // Specify the HTTP method
  headers: {
    "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your API key
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your access token
    "Content-Type": "application/json",
    "Prefer": "return=minimal",
  }
})
.then(response => {
  if (!response.ok) {
    throw new Error("Network response was not ok");
  }
  return response.json();
})
.then(addata => {
    tocheck = JSON.parse(addata[0]["Details"])
    if(deepEqual(tocheck, data)==true)
    {
        
    } 
    else
    {
        localStorage.setItem("Wallet", JSON.stringify(tocheck))
        localforage.setItem("Wallet", JSON.stringify(tocheck), function(err, value){})
        window.location.reload()
    }
})    

</script>
</body>
</html>